# JavaScript的一些细节
记录JavaScript在浏览器中运行的一些细节，可能会随着版本变动而产生变化或消失，基本记录细节，部分记录代码。

### window.location.href
- window.location.href  连续使用只会打开最后一个，需要用window.open再window.close
- 微信浏览器 的 window.open效果有差异
- Safari 中使用window.open与window.close 的效果与其他浏览器有差异
    ```
            <!-- 修改米开罗那组态时，此代码在safari中失效 -->
            let promise = new Promise(function(resolve, reject) {
                var newWin = window.open('http://192.168.1.125:8028/logout.htm');
                newWin.close();
                alert('ok');
                resolve();
             });
             
             promise.then(function() {
                window.location.href='http://192.168.1.125:8028/mobile_login.htm';
        
             });

    ```
### 获取或设置url参数
- window.location.href 整个url
- window.location.search  `?`之后的参数
- window.location.host / document.domain   域名
- window.location.protocol 协议
- window.location.pathname 路由
- window.location.hash `#`之后的参数

###  数组与字符串的“相似”方法

- 同样的方法名
    - slice(start,end),提取start到end（不包含）的元素，负值表现为从后往前，不修改原对象
    - concat(...item),连接所以item为数组或字符串，不修改原对象
- 数组
    - splice(start,num,..item),删除start开始的num个数据，从该位置添加item，<b>修改原数组</b>
    - join(separator),以separator拼接数组成一个字符串，不
- 字符串
    - split(separator,num) 以separator为标记分割字符串，返回组成的数组，长度小于num，不修改原字符串
    - substring(start,end),提取start到end（不包含）的元素,不可以为负值，不修改原字符串
    - substr 非标准方法，不用

###  网页预览PDF
- 直接通过 `a`、`embed`、`object` 、`iframe`等标签链接PDF，PC端依赖浏览器，显示还可以，移动端IOS表现为预览，安卓表现为下载，均不适用。
- 使用PDF.js预览pdf
- 使用pdf2htmlEX将pdf转换为html文件，之后再做适配
    - 使用的是pdf2htmlEX编译后的[window版本](http://soft.rubypdf.com/software/pdf2htmlex-windows-version)，win7使用需要升级powershell版本，比较麻烦
            <!-- pdf2htmlEX-win32-0.14.6-with-poppler-data.zip -->
    - 需要安装python
    - win7下用powrshell转到目录后，使用`.\pdf2htmlEX`安装，参照执行[`.\pdf2htmlEX --zoom 1.3 pdf/test.pdf`](https://github.com/coolwanglu/pdf2htmlEX/wiki/Quick-Start)，win10应该不需要`.\`
    - 对生成的html文件进行适配

### 获取滚动条
```
    function getScrollbarWidth() {
        let box = document.createElement("div");
        let scrollbarWidth = 0;
        box.style.width = "100px";
        box.style.height = "100px";
        box.style.overflowY = "scroll";
        document.body.appendChild(box); 
        scrollbarWidth = box.offsetWidth - box.clientWidth; 
        box.remove(); 
        return scrollbarWidth;
    }
```


### fetch
- 要使用fetch，前后端都设置一下headers。而不同的headers的取参数方式不一样接收之后如果是json就 res.json()，不是就 res.text()
    
<!-- TODO: -->
###  跨域
- postMessage
- jsonp
- CORS
